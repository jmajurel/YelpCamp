<% include ../layouts/header %>

<div id="showPage" class="container">
  <div class="row">
    <div class="col-md-3">
      <div class="list-group">
	<a href="#" class="list-group-item list-group-item-action active">
	  Info 1 
	</a>
	<a href="#" class="list-group-item list-group-item-action">
	  Info 2 
	</a>
	<a href="#" class="list-group-item list-group-item-action">
	  Info 3 
	</a>
      </div>
      <div id="map"></div>
    </div>
    <div class="col-md-9">
      <div class="card">
        <img class="card-img-top" src="<%= campground.image %>" alt="campground-img">
        <div class="card-body">
          <h4 class="card-title"><%= campground.name %></h4>
          <strong>
            <p class="price text-right">$<%= campground.price %>/night</p>
          </strong>
          <p class="card-text"><%= campground.desc %></p>
          <p class="card-text"><em>Posted by <%= campground.author.username %></em></p>
          <% if(currentUser && campground.author.id.equals(currentUser._id)){ %>
	    <a href="/campgrounds/<%= campground._id %>/edit" class="btn btn-warning">Update</a>
	    <form class="delete-form" action="/campgrounds/<%= campground._id %>?_method=DELETE" method="POST">
	      <input type="submit" class="btn btn-danger" value="Delete">
	    </form>
          <% }; %>
        </div>
      </div>
      <div class="card">
	<div class="card-body">
	  <h5 class="card-title">Comments</h5>
	  <% campground.comments.forEach(function(com){ %>
	    <p class="card-text"> 
	      <strong><%= com.author.username %></strong>
	      - <%= com.content %>
	    </p>
	    <% if(currentUser && com.author.id.equals(currentUser._id)){ %>
	      <a class="btn btn-sm btn-warning" href="/campgrounds/<%= campground._id %>/comments/<%= com._id %>/edit">Update</a>
	      <form class="delete-form" action="/campgrounds/<%= campground._id %>/comments/<%= com._id %>?_method=DELETE" method="POST">
		<input type="submit" class="btn btn-sm btn-danger" value="Delete">
	      </form>
            <% }; %>
	  <% }); %>
          <div>
	    <a href="/campgrounds/<%= campground._id %>/comments/new" class="btn btn-success">Create Comment</a>
          </div>
	</div>
      </div>
    </div>
  </div>
</div>

<script>
  function initMap() {
    var lat = <%= campground.lat %>;
    var lng = <%= campground.lng %>;
    var center = {lat: lat, lng: lng };
    var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 8,
        center: center,
        scrollwheel: false
    });
    var contentString = `
      <strong><%= campground.name %><br />
      <%= campground.location %></strong>
      <p><%= campground.desc %></p>
    `
    var infowindow = new google.maps.InfoWindow({
      content: contentString
    });
    var marker = new google.maps.Marker({
        position: center,
        map: map
    });
    marker.addListener('click', function() {
      infowindow.open(map, marker);
    });
  }
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkSZGwR3rltGtpO8ICZHxDNfqpDYIGN6A&callback=initMap"></script>

<% include ../layouts/footer %>
